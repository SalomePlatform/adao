<?xml version='1.0' encoding='iso-8859-1' ?>
<proc>
   <property name="DefaultStudyID" value="1"/>
   <type name="bool" kind="bool"/>
   <sequence name="boolvec" content="bool"/>
   <type name="double" kind="double"/>
   <sequence name="dblevec" content="double"/>
   <objref name="file" id="file"/>
   <type name="int" kind="int"/>
   <sequence name="intvec" content="int"/>
   <objref name="pyobj" id="python:obj:1.0"/>
   <sequence name="seqdblevec" content="dblevec"/>
   <sequence name="seqint" content="int"/>
   <sequence name="seqintvec" content="intvec"/>
   <type name="string" kind="string"/>
   <sequence name="stringvec" content="string"/>
   <container name="DefaultContainer">
      <property name="container_name" value="FactoryServer"/>
      <property name="hostname" value="localhost"/>
   </container>
   <bloc name="H_linearization">
      <foreach name="Finite_differences_derivation" type="int">
         <bloc name="Elementary_calculation">
            <inline name="Perturbated_point_X">
               <script><code><![CDATA[print iter
print seq_X[iter]
X = seq_X[iter]
]]></code></script>
               <inport name="iter" type="int"/>
               <inport name="seq_X" type="seqdblevec"/>
               <outport name="X" type="dblevec"/>
               <outport name="iter" type="int"/>
            </inline>
            <inline name="ASTER">
               <script><code><![CDATA[print 'Debut ASTER_recal'

import os
execfile( os.path.join(SOURCES_ROOT, 'N_Code_Aster.py') )

print 'RESU_CALC (%s): %s ' % (iter, RESU_CALC)
print 'DIAG (%s): %s' % (iter, DIAG)
]]></code></script>
               <inport name="X" type="dblevec"/>
               <inport name="iter" type="int"/>
               <inport name="ASTER_ROOT" type="string"/>
               <inport name="rcdir" type="string"/>
               <inport name="debug" type="bool"/>
               <inport name="DISPLAY" type="string"/>
               <inport name="SOURCES_ROOT" type="string"/>
               <inport name="export" type="string"/>
               <inport name="parametres" type="pyobj"/>
               <inport name="calcul" type="pyobj"/>
               <inport name="experience" type="pyobj"/>
               <inport name="fileparameters" type="string"/>
               <outport name="FX" type="dblevec"/>
               <outport name="FY" type="dblevec"/>
               <outport name="DIMS" type="intvec"/>
               <outport name="DIAG" type="string"/>
               <outport name="iter" type="int"/>
            </inline>
            <control> <fromnode>Perturbated_point_X</fromnode> <tonode>ASTER</tonode> </control>
            <datalink control="false">
               <fromnode>Perturbated_point_X</fromnode> <fromport>X</fromport>
               <tonode>ASTER</tonode> <toport>X</toport>
            </datalink>
            <datalink control="false">
               <fromnode>Perturbated_point_X</fromnode> <fromport>iter</fromport>
               <tonode>ASTER</tonode> <toport>iter</toport>
            </datalink>
         </bloc>
      </foreach>
      <inline name="Gradient">
         <script><code><![CDATA[
print "seq_FX=", seq_FX
print "seq_FY=", seq_FY
print "seq_DIMS=", seq_DIMS
print "lst_DIAG=", lst_DIAG
print "lst_iter=", lst_iter
print "dX=", dX

import os
execfile( os.path.join(SOURCES_ROOT, 'N_Gradient.py') )

print "fonctionnelle=", fonctionnelle
print "gradient=", gradient
]]></code></script>
         <inport name="seq_FX" type="seqdblevec"/>
         <inport name="seq_FY" type="seqdblevec"/>
         <inport name="seq_DIMS" type="seqintvec"/>
         <inport name="lst_DIAG" type="stringvec"/>
         <inport name="lst_iter" type="intvec"/>
         <inport name="dX" type="dblevec"/>
         <inport name="SOURCES_ROOT" type="string"/>
         <outport name="fonctionnelle" type="dblevec"/>
         <outport name="gradient" type="seqdblevec"/>
      </inline>
      <inline name="Input">
         <function name="inputctrl">
            <code><![CDATA[# debug : nb permet de limiter le nb de directions pour les differences finies
nb = None  # on calcule pour tous les parametres
#nb = 1

print
print "XXXXXXXXXXXXX======== Demarrage de la procedure"
print
import copy

def inputctrl( X, dX ):

   if len( X ) != len( dX ):
      raise ValueError("X and dX has to present the same lenght")

   nbparam = len(X)
   if nb: nbparam = min(nb, nbparam)
   seq_X = [ X ]
   for i in range(nbparam):
      Xplus = copy.copy(X)
      Xplus[i] = X[i] + dX[i]
      seq_X.append( Xplus )

   nb_core = 2
   itervect = range( len(seq_X) )
   nbBranches = min(nb_core, len( itervect ))

   print "  Taille du vecteur :", nbparam
   print "seq_X:", seq_X
   print "nbBranches:", nbBranches
   print "itervect:", itervect

   # debug
   #nbBranches = 1
   #if nbBranches==1:
   #    itervect = [0]
   #    seq_X = [ X ]

   return nbBranches, itervect, seq_X, dX
]]></code>
         </function>
         <inport name="X" type="dblevec"/>
         <inport name="dX" type="dblevec"/>
         <outport name="nbBranches" type="int"/>
         <outport name="itervect" type="intvec"/>
         <outport name="seq_X" type="seqdblevec"/>
         <outport name="dX" type="dblevec"/>
      </inline>
      <inline name="Temporary_Parameters">
         <script><code><![CDATA[# Boitier pour une interface simple de variables temporaires]]></code></script>
         <inport name="ASTER_ROOT" type="string"/>
         <inport name="rcdir" type="string"/>
         <inport name="debug" type="bool"/>
         <inport name="DISPLAY" type="string"/>
         <inport name="SOURCES_ROOT" type="string"/>
         <inport name="export" type="string"/>
         <inport name="parametres" type="pyobj"/>
         <inport name="calcul" type="pyobj"/>
         <inport name="experience" type="pyobj"/>
         <inport name="fileparameters" type="string"/>
         <outport name="ASTER_ROOT" type="string"/>
         <outport name="rcdir" type="string"/>
         <outport name="debug" type="bool"/>
         <outport name="DISPLAY" type="string"/>
         <outport name="SOURCES_ROOT" type="string"/>
         <outport name="export" type="string"/>
         <outport name="parametres" type="pyobj"/>
         <outport name="calcul" type="pyobj"/>
         <outport name="experience" type="pyobj"/>
         <outport name="fileparameters" type="string"/>
      </inline>
      <control> <fromnode>Finite_differences_derivation</fromnode> <tonode>Gradient</tonode> </control>
      <control> <fromnode>Input</fromnode> <tonode>Finite_differences_derivation</tonode> </control>
      <control> <fromnode>Input</fromnode> <tonode>Gradient</tonode> </control>
      <control> <fromnode>Temporary_Parameters</fromnode> <tonode>Finite_differences_derivation</tonode> </control>
      <control> <fromnode>Temporary_Parameters</fromnode> <tonode>Gradient</tonode> </control>
      <datalink control="false">
         <fromnode>Finite_differences_derivation</fromnode> <fromport>SmplPrt</fromport>
         <tonode>Finite_differences_derivation.Elementary_calculation.Perturbated_point_X</tonode> <toport>iter</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Input</fromnode> <fromport>nbBranches</fromport>
         <tonode>Finite_differences_derivation</tonode> <toport>nbBranches</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Input</fromnode> <fromport>itervect</fromport>
         <tonode>Finite_differences_derivation</tonode> <toport>SmplsCollection</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Input</fromnode> <fromport>seq_X</fromport>
         <tonode>Finite_differences_derivation.Elementary_calculation.Perturbated_point_X</tonode> <toport>seq_X</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Input</fromnode> <fromport>dX</fromport>
         <tonode>Gradient</tonode> <toport>dX</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Temporary_Parameters</fromnode> <fromport>ASTER_ROOT</fromport>
         <tonode>Finite_differences_derivation.Elementary_calculation.ASTER</tonode> <toport>ASTER_ROOT</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Temporary_Parameters</fromnode> <fromport>rcdir</fromport>
         <tonode>Finite_differences_derivation.Elementary_calculation.ASTER</tonode> <toport>rcdir</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Temporary_Parameters</fromnode> <fromport>debug</fromport>
         <tonode>Finite_differences_derivation.Elementary_calculation.ASTER</tonode> <toport>debug</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Temporary_Parameters</fromnode> <fromport>DISPLAY</fromport>
         <tonode>Finite_differences_derivation.Elementary_calculation.ASTER</tonode> <toport>DISPLAY</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Temporary_Parameters</fromnode> <fromport>SOURCES_ROOT</fromport>
         <tonode>Finite_differences_derivation.Elementary_calculation.ASTER</tonode> <toport>SOURCES_ROOT</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Temporary_Parameters</fromnode> <fromport>SOURCES_ROOT</fromport>
         <tonode>Gradient</tonode> <toport>SOURCES_ROOT</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Temporary_Parameters</fromnode> <fromport>export</fromport>
         <tonode>Finite_differences_derivation.Elementary_calculation.ASTER</tonode> <toport>export</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Temporary_Parameters</fromnode> <fromport>parametres</fromport>
         <tonode>Finite_differences_derivation.Elementary_calculation.ASTER</tonode> <toport>parametres</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Temporary_Parameters</fromnode> <fromport>calcul</fromport>
         <tonode>Finite_differences_derivation.Elementary_calculation.ASTER</tonode> <toport>calcul</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Temporary_Parameters</fromnode> <fromport>experience</fromport>
         <tonode>Finite_differences_derivation.Elementary_calculation.ASTER</tonode> <toport>experience</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Temporary_Parameters</fromnode> <fromport>fileparameters</fromport>
         <tonode>Finite_differences_derivation.Elementary_calculation.ASTER</tonode> <toport>fileparameters</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Finite_differences_derivation.Elementary_calculation.ASTER</fromnode> <fromport>FX</fromport>
         <tonode>Gradient</tonode> <toport>seq_FX</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Finite_differences_derivation.Elementary_calculation.ASTER</fromnode> <fromport>FY</fromport>
         <tonode>Gradient</tonode> <toport>seq_FY</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Finite_differences_derivation.Elementary_calculation.ASTER</fromnode> <fromport>DIMS</fromport>
         <tonode>Gradient</tonode> <toport>seq_DIMS</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Finite_differences_derivation.Elementary_calculation.ASTER</fromnode> <fromport>DIAG</fromport>
         <tonode>Gradient</tonode> <toport>lst_DIAG</toport>
      </datalink>
      <datalink control="false">
         <fromnode>Finite_differences_derivation.Elementary_calculation.ASTER</fromnode> <fromport>iter</fromport>
         <tonode>Gradient</tonode> <toport>lst_iter</toport>
      </datalink>
   </bloc>
   <parameter>
      <tonode>H_linearization.Finite_differences_derivation.Elementary_calculation.ASTER</tonode><toport>X</toport>
      <value><array><data>
<value><double>80000</double></value>
<value><double>1000</double></value>
<value><double>30</double></value>
</data></array></value>
   </parameter>
   <parameter>
      <tonode>H_linearization.Temporary_Parameters</tonode><toport>ASTER_ROOT</toport>
      <value><string>''</string></value>
   </parameter>
   <parameter>
      <tonode>H_linearization.Temporary_Parameters</tonode><toport>rcdir</toport>
      <value><string>''</string></value>
   </parameter>
   <parameter>
      <tonode>H_linearization.Temporary_Parameters</tonode><toport>debug</toport>
      <value><boolean>0</boolean></value>
   </parameter>
   <parameter>
      <tonode>H_linearization.Temporary_Parameters</tonode><toport>DISPLAY</toport>
      <value><string>:0.0</string></value>
   </parameter>
   <parameter>
      <tonode>H_linearization.Temporary_Parameters</tonode><toport>SOURCES_ROOT</toport>
      <value><string>.</string></value>
   </parameter>
   <parameter>
      <tonode>H_linearization.Temporary_Parameters</tonode><toport>export</toport>
      <value><string>''</string></value>
   </parameter>
   <parameter>
      <tonode>H_linearization.Temporary_Parameters</tonode><toport>parametres</toport>
      <value><objref><![CDATA[(lp1
.]]></objref></value>
   </parameter>
   <parameter>
      <tonode>H_linearization.Temporary_Parameters</tonode><toport>calcul</toport>
      <value><objref><![CDATA[(lp1
.]]></objref></value>
   </parameter>
   <parameter>
      <tonode>H_linearization.Temporary_Parameters</tonode><toport>experience</toport>
      <value><objref><![CDATA[(lp1
.]]></objref></value>
   </parameter>
   <parameter>
      <tonode>H_linearization.Temporary_Parameters</tonode><toport>fileparameters</toport>
      <value><string>[]</string></value>
   </parameter>
   <parameter>
      <tonode>H_linearization.Input</tonode><toport>X</toport>
      <value><array><data>
<value><double>80000</double></value>
<value><double>1000</double></value>
<value><double>30</double></value>
</data></array></value>
   </parameter>
   <parameter>
      <tonode>H_linearization.Input</tonode><toport>dX</toport>
      <value><array><data>
<value><double>0.001</double></value>
<value><double>0.001</double></value>
<value><double>0.0001</double></value>
</data></array></value>
   </parameter>
   <presentation name="H_linearization.Finite_differences_derivation.Elementary_calculation.ASTER" x="396" y="80.5" width="227.5" height="429"/>
   <presentation name="H_linearization.Finite_differences_derivation" x="368.856" y="80.5" width="651.5" height="657.5"/>
   <presentation name="H_linearization.Finite_differences_derivation.Elementary_calculation.Perturbated_point_X" x="9" y="81" width="227.5" height="139"/>
   <presentation name="H_linearization.Gradient" x="1064.38" y="338.546" width="227.5" height="284"/>
   <presentation name="H_linearization.Finite_differences_derivation.Elementary_calculation" x="9" y="130" width="633" height="518.5"/>
   <presentation name="H_linearization.Temporary_Parameters" x="10.3499" y="364.775" width="258.5" height="371"/>
   <presentation name="H_linearization" x="10.06" y="80.75" width="1301.38" height="747"/>
   <presentation name="H_linearization.Input" x="9" y="83.5" width="227.5" height="197"/>
   <presentation name="__ROOT__" x="0" y="0" width="1320.44" height="836.75"/>
</proc>
