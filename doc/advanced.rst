.. _section_advanced:

================================================================================
Advanced usage of the ADAO module
================================================================================

This section presents advanced methods to use the ADAO module, how to get more
information, or how to use it without the graphical user interface (GUI).

Exporting an ADAO command file (JDC) to YACS using a console user mode
----------------------------------------------------------------------

An export command can use the Python file generated by the editor used to build
the ADAO command file (JDC). If the ADAO command file is named "Study1.comm",
then a file named "Study1.py" can be found in the same directory. The complete
procedure is the following:

#.      using the SALOME application including ADAO module, launch SALOME with ``./runAppli -k``
#.      initialise the command line session with: ``./runSession``
#.      change to the YACS calculation scheme directory to be executed
#.      execute the export command: ``python ${ADAO_ROOT_DIR}/bin/salome/AdaoYacsSchemaCreator.py <input Python file> <output YACS xml scheme>``
#.      standard output comes on console, successive executions can be done
#.	stop SALOME:  ``killSalome.py``
#.	exit from the session: ``CTRL+D``

Be careful, if the output YACS xml scheme file already exists, this command
replace it without asking the user. The command accepts files with or without
path specifications.

It is not necessary to launch and shut down SALOME each time if the application
is already running.

Running an ADAO calculation scheme in YACS using a console user mode
--------------------------------------------------------------------

This section describes how to execute in console mode a YACS calculation scheme,
obtained using the ADAO "Export to YACS" function. It uses the standard YACS
console mode, which is briefly recalled here (see YACS documentation for more
information) through a simple example.

The way to do that is as follows:

#.      using the SALOME application including ADAO module, launch SALOME with ``./runAppli -k``
#.      initialise the command line session with: ``./runSession``
#.      change to the YACS calculation scheme directory to be executed
#.      execute the YACS supervisor:  ``driver <ADAO YACS xml scheme>``
#.      standard output comes on console, successive executions can be done
#.	stop SALOME:  ``killSalome.py``
#.	exit from the session: ``CTRL+D``

It is not necessary to launch and shut down SALOME each time if the application
is already running.

Running an ADAO calculation scheme in YACS using a TUI user mode
----------------------------------------------------------------

This section describes how to execute in TUI (Text User Interface) mode a YACS
calculation scheme, obtained using the ADAO "Export to YACS" function. It uses
the standard YACS TUI mode, which is briefly recalled here (see YACS
documentation for more information) through a simple example. As seen in
documentation, a XML scheme can be loaded in a Python. We give here a whole
sequence of command lines to test the validity of the scheme before executing
it, adding some initial supplementary ones to explicitly load the types catalog
to avoid weird difficulties::

    import pilot
    import SALOMERuntime
    import loader
    SALOMERuntime.RuntimeSALOME_setRuntime()

    r = pilot.getRuntime()
    xmlLoader = loader.YACSLoader()
    xmlLoader.registerProcCataLoader()
    try:
     catalogAd = r.loadCatalog("proc", "<ADAO YACS xml scheme>")
    except:
      pass
    r.addCatalog(catalogAd)

    try:
        p = xmlLoader.load("<ADAO YACS xml scheme>")
    except IOError,ex:
        print "IO exception:",ex

    logger = p.getLogger("parser")
    if not logger.isEmpty():
        print "The imported file has errors :"
        print logger.getStr()

    if not p.isValid():
        print "The schema is not valid and can not be executed"
        print p.getErrorReport()

    info=pilot.LinkInfo(pilot.LinkInfo.ALL_DONT_STOP)
    p.checkConsistency(info)
    if info.areWarningsOrErrors():
        print "The schema is not consistent and can not be executed"
        print info.getGlobalRepr()

    e = pilot.ExecutorSwig()
    e.RunW(p)
    if p.getEffectiveState() != pilot.DONE:
        print p.getErrorReport()

This method allows for example to edit the YACS XML scheme in TUI, or to gather
results for futher use.

Getting informations on special variables during the ADAO calculation in YACS
-----------------------------------------------------------------------------

Some special variables, used during calculations, can be monitored during the
ADAO calculation in YACS. These variables can be printed, plotted, saved, etc.
This can be done using "*observers*", that are scripts associated with one
variable. In order to use this feature, one has to build scripts using as
standard inputs (available in the namespace) the variable ``var``. This variable
is to be used in the same way as for the final ADD object.

As an example, here is one very simple script used to print the value of one
monitored variable::

    print "    ---> Value =",var.valueserie(-1)

Stored in a python file, this script can be associated to each variable
available in the "*SELECTION*" keyword of the "*Observers*" command:
"*Analysis*", "*CurrentState*", "*CostFunction*"... The current value of the
variable will be printed at each step of the optimization or assimilation
algorithm.

Getting more information when running a calculation
---------------------------------------------------

When running, the ADAO module is logging useful data and messages. There are two
ways to obtain theses informations.

The first one, and the preferred way, is to use the built-in variable "*Debug*"
integrated in every "*ASSIMILATION_STUDY*". It is available through the GUI of
the module. Setting it to "*1*" will send a lot of messages in the log window of
the YACS scheme execution.

The second one consist in using the "*logging*" native module of Python (see the
Python documentation http://docs.python.org/library/logging.html for more
informations on this module). Everywhere in the YACS scheme, mainly through the
scripts entries, the user can set the logging level in accordance to the needs
of detailed informations. The different logging levels are: "*DEBUG*", "*INFO*",
"*WARNING*", "*ERROR*", "*CRITICAL*". All the informations flagged with a
certain level will be printed for whatever activated level above this particular
one (included). The easiest way is to change the log level is to write the
following Python lines::

    import logging
    logging.getLogger().setLevel(logging.DEBUG)

The standard logging module default level is "*WARNING*", the default level in
the ADAO module is "*INFO*". 
